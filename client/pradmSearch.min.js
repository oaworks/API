var indexOf=[].indexOf;P.tabulate=function(e,r,t="striped bordered"){for(var l,s,a,o,n,i,u,c,h,d=[],p="</tr></thead><tbody>",f=0,y=e.length;f<y;f++){for(c in h=e[f])indexOf.call(d,c)<0&&d.push(c);for(p+="<tr>",a=0,i=d.length;a<i;a++)o=d[a],p+="<td>",Array.isArray(h[o])&&(h[o]=0===h[o].length?void 0:1===h[o].length?h[o][0]:"object"!=typeof h[o][0]?h[o].join(", "):h[o]),"object"==typeof h[o]?(Array.isArray(h[o])||(h[o]=[h[o]]),p+='<a href="#" onclick="if (this.nextSibling.style.display === \'none\') {this.nextSibling.style.display = \'block\'} else {this.nextSibling.style.display = \'none\'}; return false;" alt="View more" title="View more">'+h[o].length+'...</a><pre style="display:none;background:transparent;color:#333;border:none;width:100%;">',p+=P.tabulate(h[o],!0)):h[o]&&(p+=h[o]),p+="</td>";p+="</tr>"}for(p+="</tbody></table>",s="<tr>",n=0,u=d.length;n<u;n++)s+="<th>"+((l=d[n]).toUpperCase()===l||l[0].toUpperCase()===l[0]?l:l[0].toUpperCase()+l.substr(1).toLowerCase())+"</th>";return'<table class="'+t.trim()+'"'+(null!=r?' style="display:none;"':"")+"><thead>"+s+p},P.search=function(m){var e,r;for(e in null==(m=null==m?{}:m).scope&&(m.scope="body"),null==m.msg&&(m.msg="search..."),null==m.url&&(m.url=window.location.href.split("?")[0].replace(".html","")),null==m.default&&(m.default={query:{bool:{must:[],filter:[]}}}),null==m.query&&(m.query=!0),null==m.operator&&(m.operator="AND"),null==m.fuzzy&&(m.fuzzy="*"),null==m.pushstate&&(m.pushstate=!0),null==m.sticky&&(m.sticky=!0),null==m.scroll&&(m.scroll=!0),null==m.table&&(m.table=!0),(P.search.opts=m).paging=!1,m.max=!1,m.page=function(e,r){try{e.preventDefault()}catch(e){}return m.query.from=(null!=(e=m.query.from)?e:0)+(r?-1:1)*(null!=(r=m.query.size)?r:10),m.query.from<0&&(m.query.from=0),P(".PResultFrom"+m.query.from)?(P.hide(".PSearchResult"),P.show(".PResultFrom"+m.query.from),m.placeholder()):m.max?void 0:(P.show(".PLoading"),m.paging=!0,m.search())},m.previous=function(e){return m.page(e,!0)},m.next=function(e){return m.page(e)},m.from=function(){return m.query.from=parseInt(P.val(".PSearchFrom")),m.search()},m.to=function(){var e;return m.query.size=P.val(".PSearchTo")-(null!=(e=m.query.from)?e:0),m.search()},m.scroller=function(){return window.addEventListener("scroll",function(){if(!m.paging&&window.innerHeight+window.pageYOffset>=document.body.offsetHeight)return m.next()})},m.add=function(e){var r,t,l;try{e.preventDefault()}catch(e){}if(delete m.query.from,l=P.val(e.target))if(l.startsWith("opts."))if(l.includes(":")){r=l.substr(5,l.indexOf(":")).replace(" ",""),t=l.substr(l.indexOf(":")+1).trim();try{t=JSON.parse(t)}catch(e){}!1===m.scroll&&"opts.scroll"===r&&!0===t&&m.scroller();try{P.dot(m,r,t),m.search()}catch(e){}}else m.placeholder(JSON.stringify(P.dot(m,l.replace("opts.",""))));else!l.includes(":")||l.split(":")[0].includes(" ")||l.includes("*")||l.includes("~")||l.includes(" AND ")||l.includes(" OR ")?(!m.fuzzy||l.includes("*")||l.includes("~")||l.includes(":")||l.includes('"')||l.includes(" AND ")||l.includes("OR")||(l=l.trim().replace(/\s/g,m.fuzzy+" ")+m.fuzzy),m.query.query.bool.filter.push({query_string:{default_operator:m.operator,query:l.replace(/"/g,"")}})):((t={term:{}}).term[l.split(":")[0]]=l.split(":")[1].replace(/"/g,""),m.query.query.bool.filter.push(t)),m.search();try{P.set(e.target,"")}catch(e){}return P.blur(".PSearch")},m.remove=function(e){try{e.preventDefault()}catch(e){}return P(".PSearchRemove").length<=2||P.has(e.target,".PSearchRemoveAll")?P.html(".PSearches",""):P.remove(e.target.closest("a")),m.query.query.bool.filter=[],delete m.query.from,m.search()},m.placeholder=function(e){var r;return e||(e=(null!=(r=m.query.from)?r:0)+(null!=(r=m.query.size)?r:10)<m.response.hits.total?(null!=(r=m.query.from)?r:0)+(null!=(r=m.query.size)?r:10):m.response.hits.total,e+=0!==e?" of "+m.response.hits.total:""),P.set(".PSearch",""),P.attr(".PSearch","placeholder",e)},m.translate=function(){for(var e,r,t,l,s,a,o,n,i,u,c,h,d,p,f=null!=(h=m.aggregations)?h:[],y=0,g=f.length;y<g;y++)e=f[y],null==(r=m.default).aggregations&&(r.aggregations=[]),m.default.aggregations.push("string"==typeof e?{terms:{field:e}}:e);for(null==(h=m.default).size&&(h.size=m.size),s=0,o=(c=["includes","excludes"]).length;s<o;s++)null!=m[p=c[s]]&&(null==(t=m.default)._source&&(t._source={}),null==(t=m.default._source)[p]&&(t[p]=m[p]));for(m.filters&&(m.default.query.bool.filter=m.filters),"object"!=typeof m.query&&delete m.query,null==m.query&&(m.query=JSON.parse(JSON.stringify(m.default))),u=JSON.stringify(m.query.query.bool.filter).toLowerCase(),P(".PSearchVal",function(e){var r,t;try{r=P.val(e)}catch(e){}try{null==r&&(r=P.html(e))}catch(e){}if(r&&(t=(r.includes(":")?r.split(":")[1]:r).toLowerCase().replace(/"/g,""),!u.includes(t)))return r.includes(":")?((e={term:{}}).term[r.split(":")[0]]=t,m.query.query.bool.filter.push(e)):m.query.query.bool.filter.push({query_string:{default_operator:m.operator,query:r}})}),a=0,n=(d=null!=(h=m.filters)?h:[]).length;a<n;a++){l=d[a];try{u.includes(JSON.stringify(l).toLowerCase())||m.query.query.bool.filter.push(l)}catch(e){}}return m.random?(!0!==m.random&&null==m.seed&&(m.seed=m.random),null==m.seed&&(m.seed=Math.floor(1e12*Math.random())),(i={function_score:{random_score:{seed:m.seed}}}).function_score.query=m.query.query,m.query.query=i):null!=m.sort&&(m.query.sort="function"==typeof m.sort?m.sort():m.sort),m.paging&&delete m.query.aggregations,"POST"!==m.method&&(i=m.url.split("source=")[0],i+=i.includes("?")?i.endsWith("&")||i.endsWith("?")?"":"&":"?",m.url=i+"source="+encodeURIComponent(JSON.stringify(m.query))),m.query},m.first=!0,m.success=function(e){var r;P.hide(".PLoading"),P.show(".PSearchResults"),m.response=e,m.first?m.first=!1:m.placeholder(),m.render(),m.construct();try{m.max=e.hits.hits.length<(null!=(r=m.query.size)?r:10)}catch(e){}return m.paging=!1},m.error=function(e){return P.hide(".PLoading"),P.show(".PError"),console.log(e)},m.searching=!1,m.search=function(e){if(!m.searching)return m.searching=!0,P.hide(".PError"),m.paging||P.hide(".PSearchResults"),P.show(".PLoading"),m.first||P.attr(".PSearch","placeholder","searching..."),setTimeout(function(){var e={success:m.success,error:m.error,data:m.translate()};return"POST"!==m.method&&delete e.data,e.url=m.url,m.username&&m.password&&(e.headers={Authorization:"Basic "+btoa(m.username+":"+m.password)}),m.apikey&&(e.headers={apikey:m.apikey}),P.ajax(e),m.searching=!1},300)},m.render=function(){var e,r,t,l,s,a,o,n,i,u,c,h,d,p;if(m.pushstate){for(p=window.location.search.split("source=")[0],JSON.stringify(m.query)!==JSON.stringify(m.default)&&(p+=p.includes("?")?p.endsWith("&")?"":"&":"?",p+="source="+JSON.stringify(m.query));p.endsWith("&")||p.endsWith("?");)p=p.substr(0,p.length-1);try{window.history.pushState("","search",p)}catch(e){}}try{P.set(".PSearchFrom",null!=(n=m.query.from)?n:0)}catch(e){}try{P.set(".PSearchTo",(null!=(i=m.query.from)?i:0)+(null!=(null!=(u=m.response)&&null!=(c=u.hits)?c.hits:void 0)?m.response.hits.hits.length:null!=(h=m.query.size)?h:10))}catch(e){}if(!m.paging){for(P.html(".PSearches",""),t=0,a=(d=m.query.query.bool.filter).length;t<a;t++)if(r=d[t],JSON.stringify(r).includes("query_string"))o=JSON.stringify(r).split(':"').pop().split("}")[0].replace(/"/g,"").replace(/\*$/,"").replace(/\~$/,""),P.append(".PSearches",'<a class="button err PSearchRemove" href="#" alt="Remove" title="Remove"><span class="PSearchVal">'+o+"</span></a> ");else if(r.term){for(l in e='<a class="button err PSearchRemove" href="#" alt="Remove" title="Remove"><span class="PSearchVal">',r.term)e+=" "+l.replace(".keyword","").split(".").pop()+":"+r.term[l];P.append(".PSearches",e+"</span></a> ")}else if(r.range)for(s in r.range)s.replace(".keyword","").split(".").pop(),r.range[s].gte,r.range[s].lte;return m.query.query.bool.filter.length&&P.append(".PSearches",'<a class="button err c1 PSearchRemove PSearchRemoveAll" href="#" alt="Remove all" title="Remove all">X</a>'),P.on("click",".PSearchRemove",m.remove)}},m.results=[],m.result=function(e){var r,t,l,s,a,o,n,i,u;if(Array.isArray(m.table)){for(o={},t=0,a=(i=m.table).length;t<a;t++)o[i[t]]="";m.table=o}for(l in n=m.table?"<tr":'<p style="word-wrap: break-word; padding:5px; margin-bottom:0px;"',n+=' class="PSearchResult PResultFrom'+(null!=(u=m.query.from)?u:0)+'">',r=P.html(".PSearchHeaders"),"object"==typeof m.table?m.table:e)s="object"==typeof m.table&&!Array.isArray(m.table)&&m.table[l]?m.table[l]:l,m.table&&!r.includes(s)&&P.append(".PSearchHeaders","<th>"+s+"</th>"),n+=m.table?"<td>":"<b>"+s+"</b>: ",Array.isArray(e[l])&&(e[l]=0===e[l].length?void 0:1===e[l].length?e[l][0]:"object"!=typeof e[l][0]?e[l].join(", "):e[l]),"object"==typeof e[l]?(Array.isArray(e[l])||(e[l]=[e[l]]),n+='<a href="#" onclick="if (this.nextSibling.style.display === \'none\') {this.nextSibling.style.display = \'block\'} else {this.nextSibling.style.display = \'none\'}; return false;" alt="View more" title="View more">'+e[l].length+"...</a>",n+=P.tabulate(e[l],!0)):e[l]&&(n+=e[l]),n+=m.table?"</td>":", ";return n+=m.table?"</tr>":"</p>"},m.transform=!1,m.construct=function(e){var r,t,l,s,a,o,n;for(null!=(null!=(e=null==e?JSON.parse(JSON.stringify(m.response)):e)&&null!=(s=e.hits)?s.hits:void 0)&&(e=e.hits.hits),m.paging?!1===m.scroll&&P.hide(".PSearchResult"):(m.results=[],P.html(".PSearchResults","")),n=[],r=0,t=(a=null!=e?e:[]).length;r<t;r++)l=a[r],l="function"==typeof m.transform?m.transform(l):null!=(o=null!=(o=l._source)?o:l.fields)?o:l,m.results.push(l),"function"==typeof m.result?n.push(P.append(".PSearchResults",m.result(l))):n.push(void 0);return n},m.template||!1===m.template||(m.template='<div class="PSearchDiv"><div class="PSearchControls'+(m.sticky?" sticky":"")+' pb5">',m.template+='<div class="tab flex big">',!1===m.scroll&&(m.template+='<a href="#" class="button PSearchPrevious c1" alt="Previous page" title="Previous page">&lt;</a>'),m.suggest&&(m.template+='<select class="PSuggester c1"><option value="" disabled="disabled" selected="selected">&#x2315;</option></select>'),m.template+='<input type="text" class="PSearch" placeholder="'+m.msg+'">',!1===m.scroll&&(m.template+='<a href="#" class="button PSearchNext c1" alt="Next page" title="Next page">&gt;</a>'),m.template+="</div>",m.suggest&&(m.template+='<div class="PSuggestions"></div>'),m.template+='<div class="PSearches tab flex" style="margin-top:-1px;"></div>',m.template+="</div>",m.template+=m.table?'<table class="striped bordered PSearchTable"><thead><tr class="PSearchHeaders"></tr></thead><tbody class="PSearchResults"></tbody></table>':'<div class="PSearchResults"></div>',m.template+='<div class="PLoading" style="display: none; padding-bottom: 100px;"><div class="loading big"></div></div>',m.template+="</div>"),null==m.ui&&(m.ui=function(){var e,r;for(e in!1===m.template||P(".PSearch")||(P.append(m.scope,m.template),P.css(".PSearchControls","background-color",null!=(r=null!=(r=P.css(m.scope,"background"))?r:P.css(m.scope,"background-color"))?r:"#FFFFFC")),P.on("focus",".PSearch",function(){try{return P.show(".POptions")}catch(e){}}),P.on("enter",".PSearch",m.add),m)"function"==typeof m[e]&&P.on("change",".PSearch"+e[0].toUpperCase()+e.substr(1).toLowerCase(),m[e]);!1!==m.scroll&&m.scroller();try{if(!P.mobile())return P.focus(".PSearch")}catch(e){}}),"function"==typeof m.ui&&m.ui(),r=P.params())"search"!==e&&("source"===e&&(m.first=!1),m["source"===e?"query":e]=r[e]);if(m.query)return!1!==m.scroll&&delete m.query.from,m.search()};