P.suggest=function(p,e){return null==(p=null==p?{}:p).scope&&(p.scope=null!=e?e:""),p.scope&&!p.scope.endsWith(" ")&&(p.scope+=" "),null==p.query&&(p.query=!1),null==p.fuzzy&&(p.fuzzy="*"),null==p.counts&&(p.counts=!0),null==p.suggestion&&(p.suggestion=function(e,t,s,r){}),null==p.terms&&(p.terms=[]),P.suggesting=!1,p.suggestions=function(e){var t,s,r,n,u,l,a,i;try{e.preventDefault()}catch(e){}for(i=null!=(a=null!=(i=P.attr(e.target,"url"))?i:p.url)?a:window.location.href.split("?")[0].replace(".html",""),r=0,n=(l=P.classes(e.target)).length;r<n;r++)(t=l[r]).startsWith("PFor")&&(s=t);return!(a=(a=P.val(e.target))&&a.trim())||p.starter&&a.startsWith(p.starter)?a?p.starter=a:P.html(p.scope+".PSuggestions "+(null!=s?s:""),""):(P.suggesting=!0,e=P.attr(e.target,"agg"),(p.query||e)&&(u="object"==typeof p.query?JSON.parse(JSON.stringify(p.query)):{query:{bool:{filter:[]}}},p.query&&p.fuzzy&&-1===a.indexOf("*")&&-1===a.indexOf("~")&&-1===a.indexOf(":")&&-1===a.indexOf('"')&&-1===a.indexOf("AND")&&-1===a.indexOf("OR")&&(a=("*"===p.fuzzy?"*":"")+a.trim().replace(/\s/g,p.fuzzy+" "+("*"===p.fuzzy?"*":""))+p.fuzzy),u.query.bool.filter.push({query_string:{query:a}}),e&&!u.aggregations&&(null==u.size&&(u.size=0),u.aggregations={},u.aggregations[e]={terms:{field:e,size:100}})),a=i+(p.query?"POST"===p.method?"":"?source="+JSON.stringify(u):a),p.include&&(a+=(a.includes("?")?"&":"?")+"include="+("string"==typeof p.include?p.include:p.include.join(","))),a={url:a,success:e=>(P.suggesting=!1,P.html(p.scope+".PSuggestions "+(null!=s?s:""),""),p.suggest(e,s))},"POST"===p.method&&p.query&&(a.data=u),p.username&&p.password&&(a.headers={Authorization:"Basic "+btoa(p.username+":"+p.password)}),p.apikey&&(a.headers={apikey:p.apikey}),P.ajax(a))},P.on("keyup",p.scope+".PSuggest",p.suggestions,800),p.suggest=function(e,u){var l,a,t,i,s,g,r,n,o,c,y,f;if(u=p.scope+".PSuggestions"+(u?" "+u.replace(".",""):""),a=u.replace(".PSuggestions","PSuggestion"),!Array.isArray(e)&&null!=e&&e.aggregations||Array.isArray(e)&&e.length&&null!=e[0].doc_count){for(l in y=[],i=Array.isArray(e)?e:e.aggregations)y.push(function(){for(var e,t=null!=(e=i[l].buckets)?e:[],s=[],r=0,n=t.length;r<n;r++)g=t[r],s.push(P.append(u,'<a class="'+a+'" href="'+g.key+'" key="'+l('">'+g.key+"</a>"+(p.counts&&1<g.doc_count?" ("+g.doc_count+")":"")+"<br>")));return s}());return y}for(p._data=[],f=[],s=t=0,r=(o=Array.isArray(e)?e:null!=(n=null!=e&&null!=(n=e.hits)?n.hits:void 0)?n:[]).length;s<r;s++)"string"==typeof(g=o[s])?P.append(u,'<a class="'+a+'" href="'+g+'">'+g+"</a><br>"):(g._source&&(g=g._source),null==p.key&&(p.key=g.title?"title":g.name?"name":g.DOI?"DOI":g._id?"_id":g.value?"value":void 0),P.append(u,'<a class="'+a+'" href="'+(null!=(c=g[p.key])?c:"#")+'" key="'+t+'">'+(null!=(c=g[p.key])?c:JSON.stringify(g))+"</a><br>")),p._data.push(g),f.push(t+=1);return f},P.on("click",p.scope+".PSuggestion",function(e){var t,s,r,n,u,l;try{e.preventDefault()}catch(e){}for(r=0,n=(u=P.classes(e.target)).length;r<n;r++)(t=u[r]).startsWith("PFor")&&(s=t);return P.html(p.scope+".PSuggestions "+(null!=s?s:""),""),l=P.attr(e.target,"href"),P.set(".PSuggest "+(null!=s?s:""),l),p.suggestion(e,l,null!=(l=p._data)?l[P.attr(e.target,"key")]:void 0,s)},800)};