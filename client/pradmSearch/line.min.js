P.search.line=function(L){var t,D,e,r,a,n,l;for(null==(L=null==L?{}:L).period&&(L.period="days"),null==L.parseTime&&(L.parseTime=d3.timeParse("%d-%b-%y %H%M")),null==L.fill&&(L.fill=d3.scaleOrdinal(d3.schemeCategory10)),null==L.intervals&&(L.intervals=["year","month","week","day","hour","minute"]),null==L.interval&&(L.interval="day"),null==L.loop&&(L.loop="hour"===(n=L.interval)||"minute"===n),t='<svg class="PSearchLine"></svg>',r=0,a=(l=L.intervals||[]).length;r<a;r++)t+='<a class="PSearchLineRange" href="'+(e=l[r])+'">'+e+"</a> ",P.append("body",t);return P.attr(".PSearchLine","height","600"),P.attr(".PSearchLine","width","800"),P.on("click",".PSearchLineDot",function(){var t;if(must[1]={range:{createdAt:{gt:$(this).attr("val")}}},"month"===t)t="week",must[2]={range:{createdAt:{lt:parseInt($(this).attr("val"))+2592e6}}};else if("week"===t)t="day",must[2]={range:{createdAt:{lt:parseInt($(this).attr("val"))+6048e5}}};else if("day"===t)for(t="hour";1<must.length;)must.pop();else"hour"===t&&(t="minute",must[2]={range:{createdAt:{lt:parseInt($(this).attr("val"))+36e5}}});return qr.aggs.logs.date_histogram.interval=t,L.search()}),D={},P.search.line.draw=function(t,e,r=0){var a,n,l,i,s,o,u,c,d,h,g,p,f,m,v,y,k,S,x,A,w;for(P.html(".PSearchLine",""),i={},n=[],c=0,h=t.length;c<h;c++)(m=t[c]).createdAt&&(S=(1===(l=new Date(parseInt(m.createdAt))).getDate().toString().length?"0":"")+l.getDate()+"-"+["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][l.getMonth()]+"-"+l.getFullYear().toString().substring(2,4),null==i[S+="hours"===(m=L.period)||"minutes"===m?" "+l.getHours()+"00"+("minutes"===L.period?l.getMinutes():""):""]&&(i[S]=0),i[S]+=1);if(!n.length)for(a in i)n.push({key:parseTime(a),val:i[a]});for(n.sort(function(t,e){return new Date(t.key)>new Date(e.key)}),Array.isArray(n)||(n=[n]),k=d3.select("svg.PSearchLine"),f={top:10,right:5,bottom:10,left:45},x=+k.attr("width")-f.left-f.right,u=+k.attr("height")-f.top-f.bottom,o=k.append("g").attr("transform","translate("+f.left+","+f.top+")"),A=(null!=(v=n[0])&&v.date?d3.scaleUtc():d3.scaleLinear()).rangeRound([0,x]),w=d3.scaleLinear().rangeRound([u,0]),p=d3.line().x(function(t){var e;return A(null!=(e=t.date)?e:t.x)}).y(function(t){var e;return w(null!=(e=t.val)?e:t.y)}),A.domain(d3.extent(n,function(t){var e;return null!=(e=t.date)?e:t.x})).range([0,x-f.left-f.right]),w.domain(d3.extent(n,function(t){var e;return null!=(e=t.val)?e:t.y})).nice().range([u-f.top-f.bottom,0]),o.append("g").attr("class","axis").attr("transform","translate(0,"+w.range()[0]+")").call(d3.axisBottom(A)).ticks(10).tickSizeOuter(0),o.append("g").attr("class","axis").call(d3.axisLeft(w)).ticks(10).tickSizeOuter(0),y=[],d=0,g=D.length;d<g;d++)s=D[d],o.append("path").datum(s).attr("class","line values").attr("d",p).style("fill","none").attr("stroke",L.fill).style("stroke-width","1.3px"),y.push(k.selectAll("dot").data(s).enter().append("circle").attr("r",.5).attr("cx",function(t){return A(t.key)+f.left}).attr("cy",function(t){return w(t.val)+f.top}).attr("class","PSearchLineDot").attr("stroke",L.fill).attr("fill",L.fill).attr("key",function(t){return null!=(t=null!=(t=t.key)?t:e)?t:"createdAt"}).attr("val",function(t){return t.key}).style("cursor","pointer").append("title").text(function(t){return t.val+" at "+t.key}));return y},P.search.line.draw()};