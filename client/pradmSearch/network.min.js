P.search.network=function(w){var t,z,S;return null==(w=null==w?{}:w).repel&&(w.repel=5),t=d3.scaleOrdinal(d3.schemeCategory20),w.fill=function(e){return t(e.key)},w.text=w.label=function(e){return(e.val?e.key+": "+e.value:e.key)+(e.size&&e.size!==e.value?" ("+e.size+")":"")},w.radius=function(e){var t=d3.scaleLinear().domain([0,d3.max(w.nodes,function(e,t){return e.size})]).range([5,width/12]);return e.size?t(e.size):0},P.append("body",'<svg class="PSearchNetwork"></svg>'),P.attr(".PSearchNetwork","height","600"),P.attr(".PSearchNetwork","width","800"),z=S=void 0,P.search.network.draw=function(e){var t,r,n,a,l,o,i,s,u,d,c,f,h,v,k,p,g,y,x,m;if(w.nodes=null!=(v=e.nodes)?v:[],w.links=null!=(v=e.links)?v:[],!e.nodes)for(n=0,l=(c=e.hits.hits).length;n<l;n++)null==(g=null!=(f=(g=c[n])._source)?f:g.fields).key&&(g.key=null!=(h=w.valued)?h:"record"),null==g.val&&(g.val=g[w.valued]),null==g.size&&(g.size=null!=(h=null!=(h=g[w.sized])?h:w.sized)?h:1),w.nodes.push(g);for(t in null!=(v=e.aggregations)?v:{})for(a=0,o=(d=null!=(k=null!=(p=(k=e.aggregations[t]).buckets)?p:k.terms)?k:[]).length;a<o;a++){if(r=d[a],!e.links)for(s in w.nodes)(Array.isArray(w.nodes[s].val)?w.nodes[s].val:[w.nodes[s].val]).includes(r.key)&&w.links.push({source:w.nodes.length,target:parseInt(s)});e.nodes||w.nodes.push({key:t,val:r.key,size:r.doc_count})}return P.html(".PSearchNetwork",""),y=1,m=P.attr(".PSearchNetwork","width"),v=P.attr(".PSearchNetwork","height"),z=(S=d3.select(".PSearchNetwork").append("svg").attr("width",m).attr("height",v).call(d3.zoom().on("zoom",function(){return z.attr("transform",d3.event.transform),y=z.attr("transform").split("scale")[1].replace("(","").replace(")","")}))).append("g"),i=z.append("g").selectAll(),u=z.append("g").selectAll(),x=d3.forceSimulation(w.nodes).force("charge",d3.forceManyBody().strength(-w.repel*(m/10))).force("link",d3.forceLink(w.links).distance(m/4-50)).force("collide",d3.forceCollide().radius(function(e){return 1.3*w.radius(e)})).force("center",d3.forceCenter(m/2,v/2)).force("x",d3.forceX()).force("y",d3.forceY()).on("tick",function(){return u.attr("transform",function(e){return"translate("+[e.x,e.y]+")"}),P.attr(".nodeText","font-size",function(e){return 6e-4*m*(y<1?y:1/y)+"em"}),i.attr("x1",function(e){var t,r;return null!=(r=null!=(t=null!=(t=e.source)?t.y:void 0)?t:null!=(r=e.target)?r.y:void 0)?r:e.y}).attr("y1",function(e){var t,r;return null!=(r=null!=(t=null!=(t=e.source)?t.y:void 0)?t:null!=(r=e.target)?r.y:void 0)?r:e.y}).attr("x2",function(e){var t,r;return null!=(r=null!=(t=null!=(t=e.source)?t.x:void 0)?t:null!=(r=e.target)?r.x:void 0)?r:e.x}).attr("y2",function(e){var t,r;return null!=(r=null!=(t=null!=(t=e.source)?t.y:void 0)?t:null!=(r=e.target)?r.y:void 0)?r:e.y})}),(u=(u=u.data(w.nodes)).enter().append("g").on("mouseover",function(t){return P.show(".nodeText"),P.attr(".PSearch","pre",P.attr(".PSearch","placeholder")),P.attr(".PSearch","placeholder",w.label(t)),i.attr("stroke",function(e){if(t.index===e.source.index||t.index===e.target.index)return"#666"})}).on("mouseout",function(){return i.attr("stroke","#aaa"),P.hide(".nodeText"),P.attr(".PSearch","placeholder",P.attr(".PSearch","pre"))}).on("click",w.click).call(d3.drag().on("start",function(e){return d3.event.active||x.alphaTarget(.3).restart(),e.fx=e.x,e.fy=e.y}).on("drag",function(e){return e.fx=d3.event.x,e.fy=d3.event.y}).on("end",function(e){return d3.event.active||x.alphaTarget(0),e.fx=null,e.fy=null})).merge(u)).append("circle").attr("class","node").attr("r",w.radius).attr("fill",w.fill).style("cursor","pointer").attr("stroke","#666").attr("stroke-width",1).append("svg:title").text(w.label),u.append("text").classed("nodeText",!0).text(w.text).attr("font-size",function(){return 4e-4*m*(1/y)+"em"}).attr("dy",function(e){return 1.1*w.radius(e)}),u.exit().remove(),(i=i.data(w.links)).exit().remove(),(i=i.enter().append("line").merge(i)).attr("class","net").attr("stroke","#aaa").attr("stroke-width",1),x.nodes(w.nodes),x.force("link").links(w.links),x.alpha(1).restart(),P.hide(".nodeText")},P.search.network.draw(),P.search.network.zoom=function(e){var t=P.attr(S,"height"),r=P.attr(S,"width");return z.attr("transform","translate("+r/2+", "+t/2+") scale("+e+") translate("+-r/2+", "+-t/2+")")}};