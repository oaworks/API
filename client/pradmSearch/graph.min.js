P.search.graph=function(x){return null==x&&(x={}),P.append("body",'<svg class="PSearchGraph"></svg>'),P.attr(".PSearchGraph","height","600"),P.attr(".PSearchGraph","width","800"),P.search.graph.draw=function(a){var r,t,e,n,l,i,c,s,d,h,o,p,f,u,g,y,m,v;P.html(".PSearchGraph",""),i=["val"],r=[];try{for(u=a.aggregations["undefined"!=typeof WHAT&&null!==WHAT].terms,n=0,s=u.length;n<s;n++)t=u[n],r.push({key:t.key,val:t.doc_count})}catch(t){try{for(g=a.hits.hits,c=0,d=g.length;c<d;c++)for(f=g[c],o=0,h=i.length;o<h;o++)l=i[o],r.push({key:l,val:f[l]})}catch(t){}}return p={top:10,right:5,bottom:10,left:60},a=+(y=d3.select("svg.PSearchGraph")).attr("width")-p.left-p.right,e=+y.attr("height")-p.top-p.bottom,p=y.append("g").attr("transform","translate("+p.left+","+p.top+")"),m=d3.scaleBand().rangeRound([0,a]).paddingInner(.1),v=d3.scaleLinear().rangeRound([e,0]),m.domain(r.map(function(t){return t.key})),v.domain([0,d3.max(r,function(t){return t.val})]),x.fill=i.length<2?function(t){return"steelblue"}:i.length<10?d3.scaleOrdinal(d3.schemeCategory10):d3.scaleOrdinal(d3.schemeCategory20c),p.append("g").selectAll("g").data(r).enter().append("rect").attr("x",function(t){return m(t.key)}).attr("y",function(t){return v(t.val)}).attr("width",function(t){return m.bandwidth()}).attr("height",function(t){return e-v(t.val)}).attr("fill",x.fill).append("title").text(function(t){return t.key+"\n"+t.val}),p.append("g").attr("class","axis").attr("transform","translate(0,"+e+")"),p.append("g").attr("class","axis").call(d3.axisLeft(v).ticks(10,"s").tickSize(-a,0,0).tickSizeOuter(0)),(p=p.append("g").attr("font-family","sans-serif").attr("font-size",10).attr("text-anchor","end").selectAll("g").data(i.slice().reverse()).enter().append("g").attr("transform",function(t,a){return"translate(100,"+(20*a-100)+")"})).append("circle").attr("r",8).attr("cx",a-10).attr("cy",10).attr("fill",x.fill).attr("stroke",x.fill).attr("stroke-width","2px"),p.append("text").attr("x",a-24).attr("y",9.5).attr("dy","0.32em").text(function(t){return t})},P.search.graph.draw()};