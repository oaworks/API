P.search.spark=function(d){var u,h;return null==(d=null==d?{}:d).span&&(d.span=3e5),null==d.loop&&(d.loop=5e3),null==d.fill&&(d.fill=function(){return"steelblue"}),h={},u=!0,P.search.spark.draw=function(a){var e,r,l,t,n,s,i,p,o=[];for(l in a)n="#PSearchSpark_"+(t=l.replace(/[^a-zA-Z0-9]/g,"_")),P(n)?(h[l].values.shift(),o.push(h[l].values.push(a[l].value))):(h[l]=a[l],null==(e=h[l]).values&&(e.values=new Array(Math.floor(d.span/d.loop)).fill(0)),P.prepend(".PSearchSpark",'<div class="PSearchSparks" id="PSearchSpark_'+t+'" style="width:100%;height:60px;margin-top:-22px;"></div>'),s=P(n).width(),r=P(n).height(),e=d3.select(n).append("svg:svg").attr("width","100%").attr("height","100%"),n=s/h[pid].values.length,i=d3.scale.linear().domain([0,h[pid].values.length]).range([Math.floor(-n/2),Math.ceil(s+1.5*n)]),(s=d3.max(h[pid].values))<10&&(s=10),p=d3.scale.linear().domain([s,0]).range([0,r]),n=d3.svg.line().x(function(a,e){return i(e)}).y(function(a){return p(a)}).interpolate("basis"),e.append("svg:path").attr("d",n(h[pid].values)),$(".panels").css({"border-color":"#4682B4","background-color":"transparent"}),s=d3.max(h[pid].values),h[pid].values.indexOf(s)===h[pid].values.length&&(p=d3.scale.linear().domain([s,0]).range([0,r]),$("#panel_"+t).css({"border-color":"orange"})),e.selectAll("path").data([h[pid].values]).attr("stroke",d.fill).style("stroke-width","1.3px").attr("transform","translate("+i(1)+")").attr("d",n),u?(u=!1,o.push(e.selectAll("path").transition().ease(d3.easeLinear).duration(d.loop).attr("transform","translate("+i(0)+")").on("end",d.search))):o.push(e.selectAll("path").transition().ease(d3.easeLinear).duration(d.loop).attr("transform","translate("+i(0)+")")));return o},P.search.spark.draw()};