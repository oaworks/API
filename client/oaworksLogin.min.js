var _OALogin=function(n){var o;if(n.startsWith("#")?o=document.getElementById(n):null!=(o=document.getElementsByClassName(n.replace(/^\./,"").replace(/\s\./g," ").trim()))&&1===o.length&&(o=o[0]),null!=o&&(n.startsWith("#")||0!==o.length))return o};_OALogin.each=function(n,o){for(var e,t,i=[],a=0,r=(t=null!=(n=null==(n="string"==typeof n?_OALogin(n):n)||Array.isArray(n)||HTMLCollection.prototype.isPrototypeOf(n)||NodeList.prototype.isPrototypeOf(n)?n:[n])?n:[]).length;a<r;a++)e=t[a],i.push(o(e));return i},_OALogin.show=function(n,e,t){return _OALogin.each(n,function(n){var o;return e&&(n.innerHTML=(t?n.innerHTML:"")+e+(!1===t?n.innerHTML:"")),o=n.getAttribute("OALoginDisplay"),n.style.display=o="string"==typeof o&&"none"!==o?o:"block"})},_OALogin.hide=function(n){return _OALogin.each(n,function(n){return"none"!==n.style.display&&n.setAttribute("OALoginDisplay",n.style.display),n.style.display="none"})},_OALogin.ajax=function(n,e){var o,t,i,a,r,g;"object"==typeof n&&(e=n,n=void 0),(""===(n=null==n?null!=(r=e.url)?r:"":n)||n.startsWith("/")&&!n.startsWith("//"))&&(n="//"+window.location.host+n),null==(e=null==e?{}:e).headers&&(e.headers={}),"string"==typeof e.method&&(e.method=e.method.toUpperCase()),null!=e.data&&(e.method="POST","object"==typeof e.data)&&"function"!=typeof e.data.append&&(e.data=JSON.stringify(e.data),null==(r=e.headers)["Content-type"])&&(r["Content-type"]="application/json");try{e.headers.Authorization||e.headers.authorization||e.headers.apikey||e.headers["x-apikey"]||(e.username&&e.password?null==(o=e.headers).Authorization&&(o.Authorization="Basic "+btoa(e.username+":"+e.password)):(e.apikey||e["x-apikey"])&&(e.headers.apikey=null!=(a=e.apikey)?a:e["x-apikey"]))}catch(n){}for(t in(g=new XMLHttpRequest).open(null!=(r=e.method)?r:"GET",n),e.headers)g.setRequestHeader(t,e.headers[t]);i=!1,g.onload=function(){var o;i=!0;try{if(199<g.status&&g.status<400){o=g.response;try{o=JSON.parse(o)}catch(n){}try{return e.success(o,g)}catch(n){}}else try{return e.error(g)}catch(n){}}catch(n){o=n;try{console.log(o)}catch(n){}try{return e.error(g)}catch(n){}}},g.onerror=function(n){try{return e.error(n,g)}catch(n){}},g.onloadend=function(){try{if(404===g.status&&!i)return e.error(g)}catch(n){}};try{return g.send(e.data)}catch(n){}},_OALogin.cookie=function(n,o,e){var t,i,a,r,g,l;if(""!==n&&!1!==n&&"object"!=typeof n||(o=n,n=void 0),null==n&&(n="oaworksLogin"),null!=o)return(e=null==e?{}:e).domain?i=!0:(i=!1,e.domain="."+window.location.host,e.domain.startsWith(".bg.")&&(e.domain=e.domain.replace(".bg.","."))),l=n+"=",o?l+=encodeURIComponent(JSON.stringify(o)):e.expires=-1,"number"==typeof(o=null!=(o=e.expires)?o:180)&&(o=new Date).setDate(o.getDate()+e.expires),o instanceof Date&&(l+="; expires="+new Date(o).toUTCString()),"string"==typeof e.domain&&""!==e.domain&&(l+="; domain="+e.domain),l+="; path="+("string"==typeof e.path&&""!==e.path?e.path:"/"),!1!==e.secure&&(l+="; secure"),e.httponly&&(l+="; HttpOnly"),document.cookie=l,-1===e.expires&&e.domain&&!i&&(o=l.split("; domain=")[0],document.cookie=o),l;for(a=0,r=(g=document.cookie.split(";")).length;a<r;a++){for(t=g[a];" "===t.charAt(0);)t=t.substring(1);if(-1!==t.indexOf(n+"="))return JSON.parse(decodeURIComponent(t.substring(n.length+1,t.length)))}return!1},_OALogin.account=void 0,_OALogin.token=function(n){try{n.preventDefault()}catch(n){}if(_OALogin.cookie(!1),n=document.getElementById("OALoginEmail").value)return _OALogin.hide(".OALoginEmail"),_OALogin.show(".OALoading"),_OALogin.show(".OALoginToken"),n={success:function(n){return _OALogin.hide(".OALoading"),document.getElementById("OALoginToken").focus(),_OALogin._loggingin=setInterval(function(){if(_OALogin.loggedin())return _OALogin.loginSuccess()},2e3)},data:{email:n,url:window.location.protocol+"//"+window.location.host+window.location.pathname}},_OALogin.ajax("/auth/token",n);document.getElementById("OALoginEmail").focus()},_OALogin.loginSuccess=function(n){if(_OALogin._loggingin&&(clearInterval(_OALogin._loggingin),delete _OALogin._loggingin),_OALogin.hide(".OALogin"),_OALogin.hide(".OALoading"),_OALogin.hide(".OALoginToken"),"object"==typeof n&&(_OALogin.account=n,_OALogin.cookie(n)),_OALogin.loginNext||-1===window.location.search.indexOf("next=")?!_OALogin.loginNext&&window.location.search.startsWith("?next")&&(_OALogin.loginNext=!0):_OALogin.loginNext=decodeURIComponent(window.location.search.split("next=")[1].split("&")[0]),_OALogin.loginNext)return!0===_OALogin.loginNext?location.reload():window.location=_OALogin.loginNext;try{_OALogin.show(".OALoginLogout"),document.getElementById("OALoginLogout").addEventListener("click",_OALogin.logout)}catch(n){}try{if("function"==typeof _OALogin.afterLogin)return _OALogin.afterLogin()}catch(n){}},_OALogin.loginError=function(n,o){return console.log("Login error"),console.log(n),console.log(o),_OALogin._loggingin&&(clearInterval(_OALogin._loggingin),delete _OALogin._loggingin),_OALogin.cookie(!1),_OALogin.account=void 0,_OALogin.hide(".OALoading"),_OALogin.hide(".OALoginToken"),document.getElementById("OALoginEmail").value="",document.getElementById("OALoginEmail").setAttribute("placeholder","error, enter your email to try again"),_OALogin.show(".OALoginEmail"),_OALogin.show(".OALogin")},_OALogin.login=function(n){var o;try{n.preventDefault()}catch(n){}if(n={success:_OALogin.loginSuccess,error:_OALogin.loginError,data:{}},o=document.getElementById("OALoginToken").value,8===window.location.hash.replace("#","").length){n.data.token=window.location.hash.replace("#","");try{window.history.pushState("","",window.location.pathname)}catch(n){}}else"string"==typeof o&&8===o.length?n.data.token=o:(o=_OALogin.loggedin())&&(n.data.email=o.email,n.data.resume=o.resume);if(n.data.email&&n.data.resume||n.data.hash||n.data.token)return _OALogin.hide(".OALoginEmail"),_OALogin.hide(".OALoginToken"),_OALogin.show(".OALoading"),_OALogin.ajax("/auth",n)},_OALogin.loggedin=function(){var n;return(n=_OALogin.cookie())&&"object"==typeof n&&"{}"!==JSON.stringify(n)&&(_OALogin.account=n),_OALogin.account},_OALogin.logout=function(n){try{n.preventDefault()}catch(n){}if(_OALogin.show(".OALoading"),n=_OALogin.loggedin())return _OALogin.ajax("/auth/logout?apikey="+n.apikey,{success:function(){if(_OALogin.account=void 0,_OALogin.cookie(!1),_OALogin.hide(".OALoading"),!0===_OALogin.loginNext)return location.reload();if(_OALogin.loginNext)return window.location=_OALogin.loginNext;if("function"==typeof _OALogin.afterLogout)try{return _OALogin.afterLogout()}catch(n){}}})},document.addEventListener("DOMContentLoaded",function(){var n;try{document.getElementById("OALoginEmail").addEventListener("keyup",function(n){if(13===n.keyCode)return _OALogin.token(n)})}catch(n){}try{document.getElementById("OALoginToken").addEventListener("keyup",function(n){if(8===document.getElementById("OALoginToken").value.length)return _OALogin.login()})}catch(n){}if((n=_OALogin.loggedin())||"string"==typeof window.location.hash&&window.location.hash&&8===window.location.hash.replace("#","").length)return n&&(_OALogin.loginNext=void 0),_OALogin.login()});